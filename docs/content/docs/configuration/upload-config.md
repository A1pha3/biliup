+++
title = "上传配置"
description = "详细了解视频上传相关的配置选项，包括线路选择、并发控制和元信息设置"
date = 2025-01-10T00:00:00+00:00
updated = 2025-01-10T00:00:00+00:00
draft = false
weight = 30
template = "docs/page.html"

[extra]
lead = "本文档详细说明上传相关的所有配置项，包括上传线路、并发数、视频元信息、封面上传和延时发布等功能。"
toc = true
top = false
+++

## 概述

biliup 提供了丰富的上传配置选项，可以精确控制上传行为、优化上传速度和自定义视频元信息。

## 基本上传配置

### uploader

选择上传插件。

**类型**：字符串  
**必需**：否  
**默认值**：`biliup-rs`

**可选值：**
- `biliup-rs`：Rust 上传器（推荐，速度快、稳定性好）
- `bili_web`：网页接口上传
- `Noop`：不上传，但会执行后处理

**示例：**
```toml
uploader = "biliup-rs"
```

```yaml
uploader: biliup-rs
```

**说明：**
- `biliup-rs` 是默认推荐的上传器，性能最佳
- `Noop` 适用于只录制不上传的场景
- 可在主播配置中单独覆盖

### submit_api

B 站提交接口选择。

**类型**：字符串  
**必需**：否  
**默认值**：自动选择

**可选值：**
- `web`：网页接口
- `client`：客户端接口

**示例：**
```toml
submit_api = "client"
```

**说明：**
- 默认自动选择最优接口
- 客户端接口通常更稳定

### lines

上传线路选择。

**类型**：字符串  
**必需**：否  
**默认值**：`AUTO`

**可选值：**
- `AUTO`：自动选择最优线路（推荐）
- `bda2`：大陆线路
- `bldsa`：大陆线路
- `qn`：全球线路
- `tx`：腾讯云（大陆）
- `txa`：腾讯云（海外）
- `alia`：阿里云（海外）

**示例：**
```toml
lines = "AUTO"
```

```yaml
lines: AUTO
```

**说明：**
- 推荐使用 `AUTO` 自动选择
- 如果上传速度不理想，可以手动切换线路
- 海外用户建议尝试 `alia` 或 `txa`

### threads

单文件并发上传数。

**类型**：整数  
**必需**：否  
**默认值**：3

**示例：**
```toml
threads = 3
```

**说明：**
- 未达到带宽上限时，增大此值可提高上传速度
- 不要设置过大，部分线路限制为 8
- 如速度不佳，优先调整上传线路而非并发数

## 视频元信息配置

这些配置项通常在主播配置中设置，也可以作为全局默认值。

### title

视频标题模板。

**类型**：字符串  
**必需**：否  
**默认值**：`{title}`

**占位符：**
- `{title}`：直播间标题
- `{streamer}`：主播名称
- `{url}`：直播间 URL
- 时间格式：支持 strftime 格式

**示例：**
```toml
title = "{title}%Y-%m-%d{streamer}"
```

**说明：**
- 详细说明请参考[主播配置](./streamer-config.md#title)

### description

视频简介模板。

**类型**：字符串  
**必需**：否  
**默认值**：空

**示例：**
```toml
description = """
视频简介: {title} %Y-%m-%d %H:%M:%S
主播直播间：{url}
"""
```

```yaml
description: |-
  视频简介: {title} %Y-%m-%d %H:%M:%S
  主播直播间：{url}
```

**说明：**
- 支持多行文本
- 支持占位符和时间格式化
- 详细说明请参考[主播配置](./streamer-config.md#description)

### dynamic

投稿动态文本。

**类型**：字符串  
**必需**：否  
**默认值**：空

**示例：**
```toml
dynamic = "#直播录像# #游戏#"
```

**说明：**
- 会显示在个人动态中
- 可使用话题标签

### source

视频来源说明。

**类型**：字符串  
**必需**：否  
**默认值**：空

**示例：**
```toml
source = "转载自 Twitch"
```

**说明：**
- 用于说明视频来源
- 转载视频建议填写


## 封面配置

### cover_path

自定义封面图片路径。

**类型**：字符串  
**必需**：否  
**默认值**：无

**示例：**
```toml
cover_path = "/path/to/cover.jpg"
```

**说明：**
- 支持 JPG、PNG 格式
- 推荐尺寸：1920x1080 或 16:9 比例
- 可以是绝对路径或相对路径

### use_live_cover

使用直播间封面作为投稿封面。

**类型**：布尔值  
**必需**：否  
**默认值**：false

**示例：**
```toml
use_live_cover = true
```

```yaml
use_live_cover: true
```

**说明：**
- 目前支持 Bilibili、Twitch、YouTube
- 封面保存在 `cover/` 目录，上传后自动删除
- 优先级低于 `cover_path`

**封面优先级：**
1. 主播配置中的 `cover_path`
2. 主播配置中的 `use_live_cover`
3. 全局配置中的 `use_live_cover`
4. 无封面（使用 B 站默认封面）

## 延时发布配置

### dtime

设置延时发布时间。

**类型**：整数（Unix 时间戳）  
**必需**：否  
**默认值**：立即发布

**示例：**
```toml
dtime = 1710000000  # 2024-03-09 16:00:00 UTC
```

**说明：**
- 格式为 Unix 时间戳（秒）
- 必须距离提交时间大于 2 小时
- 可用于定时发布视频

**获取时间戳：**
```bash
# Linux/macOS
date -d "2024-03-09 16:00:00" +%s

# 在线工具
# https://tool.lu/timestamp/
```

## 视频属性配置

### copyright

版权声明。

**类型**：整数  
**必需**：否  
**默认值**：2（转载）

**可选值：**
- `1`：自制
- `2`：转载

**示例：**
```toml
copyright = 2
```

### tid

投稿分区 ID。

**类型**：整数  
**必需**：否  
**默认值**：无（需要手动选择）

**示例：**
```toml
tid = 171  # 电子竞技
```

**说明：**
- 详细分区列表请参考[主播配置](./streamer-config.md#tid)

### tags

视频标签。

**类型**：字符串数组  
**必需**：否  
**默认值**：空数组

**示例：**
```toml
tags = ["直播录像", "游戏", "娱乐"]
```

```yaml
tags:
  - 直播录像
  - 游戏
  - 娱乐
```

**说明：**
- 最多 12 个标签
- 每个标签最长 20 个字符

### dolby

是否开启杜比音效。

**类型**：整数  
**必需**：否  
**默认值**：0（关闭）

**可选值：**
- `0`：关闭
- `1`：开启

**示例：**
```toml
dolby = 1
```

### hires

是否开启 Hi-Res 高解析度音频。

**类型**：整数  
**必需**：否  
**默认值**：0（关闭）

**可选值：**
- `0`：关闭
- `1`：开启

**示例：**
```toml
hires = 1
```

### no_reprint

自制声明（未经允许禁止转载）。

**类型**：整数  
**必需**：否  
**默认值**：0（允许转载）

**可选值：**
- `0`：允许转载
- `1`：未经允许禁止转载

**示例：**
```toml
no_reprint = 1
```

### charging_pay

是否开启充电面板。

**类型**：整数  
**必需**：否  
**默认值**：0（关闭）

**可选值：**
- `0`：关闭
- `1`：开启

**示例：**
```toml
charging_pay = 1
```

**说明：**
- 需要账号满足充电条件

### is_only_self

视频可见范围。

**类型**：整数  
**必需**：否  
**默认值**：0（公开）

**可选值：**
- `0`：公开
- `1`：仅自己可见

**示例：**
```toml
is_only_self = 1
```

**说明：**
- 可用于先上传后审核，确认无误后再公开

## 上传策略配置示例

### 示例 1：快速上传（默认配置）

```toml
uploader = "biliup-rs"
lines = "AUTO"
threads = 3
```

**适用场景：**
- 大部分用户
- 网络状况良好
- 追求稳定性

### 示例 2：高速上传

```toml
uploader = "biliup-rs"
lines = "bda2"  # 或根据测试选择最快线路
threads = 8
```

**适用场景：**
- 大带宽用户
- 追求上传速度
- 需要快速发布

**注意：**
- 部分线路限制并发数为 8
- 过高的并发可能导致不稳定

### 示例 3：海外上传

```toml
uploader = "biliup-rs"
lines = "alia"  # 或 txa
threads = 3
```

**适用场景：**
- 海外服务器
- 跨境上传
- 国际网络环境

### 示例 4：仅录制不上传

```toml
uploader = "Noop"
```

**适用场景：**
- 只需要录制功能
- 手动上传
- 本地存档

### 示例 5：多账号上传

```toml
# 全局默认账号
[user]
bili_cookie_file = "default.json"

# 主播A使用账号1
[streamers."主播A"]
url = ["https://example.com/A"]
user_cookie = "account1.json"

# 主播B使用账号2
[streamers."主播B"]
url = ["https://example.com/B"]
user_cookie = "account2.json"
```

**适用场景：**
- 多个 B 站账号
- 分账号管理不同内容
- 避免单账号投稿过多


### 示例 6：延时发布

```toml
[streamers."主播"]
url = ["https://example.com"]
dtime = 1710086400  # 2024-03-10 16:00:00 UTC
```

**适用场景：**
- 定时发布视频
- 配合活动时间
- 避开高峰期

### 示例 7：完整元信息配置

```toml
[streamers."主播"]
url = ["https://www.twitch.tv/username"]
title = "{title}%Y-%m-%d{streamer}"
tid = 171
copyright = 2
tags = ["游戏", "直播录像", "电竞"]
description = """
视频简介: {title}
录制时间: %Y-%m-%d %H:%M:%S
主播直播间：{url}
---
Powered By biliup"""
dynamic = "#游戏直播# #电子竞技#"
source = "转载自 Twitch"
cover_path = "/covers/default.jpg"
dolby = 0
hires = 0
no_reprint = 0
charging_pay = 0
```

**适用场景：**
- 需要完整元信息
- 规范化投稿
- 提高视频质量

## 上传线路选择指南

### 如何选择最优线路

1. **使用默认 AUTO**（推荐）
   ```toml
   lines = "AUTO"
   ```
   - 自动选择最优线路
   - 适合大部分用户

2. **测试不同线路**
   ```bash
   # 修改配置文件，依次测试
   lines = "bda2"
   lines = "qn"
   lines = "tx"
   ```
   - 观察上传速度
   - 选择最快的线路

3. **根据地理位置选择**
   - 大陆用户：`bda2`、`tx`、`bldsa`
   - 海外用户：`alia`、`txa`、`qn`

### 线路对比

| 线路代码 | 说明 | 适用地区 | 特点 |
|---------|------|---------|------|
| AUTO | 自动选择 | 全球 | 推荐，自动优选 |
| bda2 | 大陆线路 | 中国大陆 | 稳定性好 |
| bldsa | 大陆线路 | 中国大陆 | 备选线路 |
| tx | 腾讯云 | 中国大陆 | 速度快 |
| txa | 腾讯云 | 海外 | 海外优选 |
| alia | 阿里云 | 海外 | 海外备选 |
| qn | 全球线路 | 全球 | 通用线路 |

## 上传性能优化

### 提升上传速度

1. **选择最优线路**
   - 使用 AUTO 或手动测试
   - 根据网络环境选择

2. **调整并发数**
   ```toml
   threads = 5  # 根据带宽调整
   ```
   - 带宽充足时增大
   - 注意线路限制

3. **使用 biliup-rs**
   ```toml
   uploader = "biliup-rs"
   ```
   - 性能最佳
   - 推荐使用

4. **网络优化**
   - 使用有线连接
   - 避开网络高峰期
   - 考虑使用代理（如需要）

### 避免上传失败

1. **稳定的网络连接**
   - 避免使用不稳定的网络
   - 大文件上传时保持连接

2. **合理的分段设置**
   ```toml
   file_size = 2621440000  # 2.5GB
   ```
   - 避免单文件过大
   - 减少上传失败风险

3. **正确的 Cookie 配置**
   - 确保 Cookie 有效
   - 定期更新 Cookie
   - 参考[认证配置](./authentication.md)

4. **监控日志**
   ```bash
   tail -f ds_update.log
   ```
   - 及时发现问题
   - 根据错误信息调整

## 常见问题

### 上传速度慢

**问题**：上传速度远低于带宽

**解决方案：**
1. 切换上传线路
   ```toml
   lines = "bda2"  # 尝试不同线路
   ```

2. 增加并发数
   ```toml
   threads = 5  # 逐步增加测试
   ```

3. 检查网络状况
   - 测试网络速度
   - 避开高峰期

4. 使用 biliup-rs
   ```toml
   uploader = "biliup-rs"
   ```

### 上传失败

**问题**：上传过程中断或失败

**解决方案：**
1. 检查 Cookie 是否有效
2. 切换上传线路
3. 减小文件大小（分段录制）
4. 查看日志获取详细错误信息

### Cookie 过期

**问题**：提示认证失败

**解决方案：**
1. 重新获取 Cookie
2. 更新配置文件
3. 参考[认证配置](./authentication.md)

### 视频审核不通过

**问题**：上传成功但审核失败

**解决方案：**
1. 检查视频内容是否符合规范
2. 确认分区选择正确
3. 完善视频信息（标题、简介、标签）
4. 避免敏感内容

## 相关链接

- [配置文件格式](./config-file-format.md)
- [主播配置详解](./streamer-config.md)
- [高级配置选项](./advanced-config.md)
- [认证配置](./authentication.md)
- [配置示例集](./examples.md)
